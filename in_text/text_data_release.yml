title: >-
  Data release: Compliation of multi-agency water temperature observations for U.S. streams, 1894-2022

abstract: >-
  This data release collates stream water temperature observations across the United States from four sources: 
  The U.S. Geological Survey's National Water Information System (NWIS),  Water Quality Portal (WQP),  Spatial Hydro-Ecological Decision Systems (EcoSHEDS)
  temperature database (EcoSHEDS), and the U.S. Fish and Wildlife's NorWeST stream temperature database. Observations are included from
  the contiguous continental US, as well as Alaska, Hawaii, and territories. Temperature monitoring sites were paired to stream
  segments from the Geospatial Fabric for the National Hydrologic Model. Continuous and discrete data were reduced to daily mean, minimum, and maximum temperatures
  when sub-daily measurements were available. Various quality control checks were conducted including inspecting and converting units,
  eliminating duplicate entries, interpreting flags and removing low quality observations, fixing date issues from the WQP,
  and filtering to expected water temperature ranges. However, we expect data quality issues persist and users should
  conduct further data quality checks that match the intended use of the data. 
  

  
authors: ["Samantha K. Oliver", "Alison Appling", "David Watkins", "Rasha Atshan", "Jordan Read"]
pubdate: 2023 # replace with actual year, e.g., 2020
doi: https://doi.org/10.5066/P9EMWZ35 # replace with actual DOI

build-environment: >-
  This dataset was generated using open source tools available in the R programming language (R version 4.0.2 (2020-06-22)).
  
  The computing platform for generating data and metadata was x86_64-w64-mingw32. 
  
  R packages loaded into this environment: ggsn, version: 0.5.3; ggmap, version: 3.0.0; sbtools, version: 1.1.12; assertthat, version: 0.2.1; nhdplusTools, version: 0.3.16; sf, version: 0.9-7; readxl, version: 1.3.1; lubridate, version: 1.7.9.2; xml2, version: 1.3.2; ggthemes, version: 4.2.0; maps, version: 3.3.0; yaml, version: 2.2.1; dataRetrieval, version: 2.7.7; scipiper, version: 0.0.24; forcats, version: 0.5.0; stringr, version: 1.4.0; dplyr, version: 1.0.2; purrr, version: 0.3.4; readr, version: 1.4.0; tidyr, version: 1.1.2; tibble, version: 3.0.4; ggplot2, version: 3.3.2; tidyverse, version: 1.3.0.

# ----supporting publications----    
cross-cites:
  -
    authors: 
    title: >-
      SHEDS Stream Temperature Database, accessed on 2020-06-22 
    pubdate: 
    link: http://db.ecosheds.org/
  -
    authors: ['U.S. Geological Survey']
    title: >-
      USGS Water Data for the Nation, accessed on 2021-04-07
    pubdate: 2016
    link: https://waterdata.usgs.gov/nwis
  -
    authors: ['Emily K. Read',  'Lindsay Carr',  'Laura De Cicco',  'Hilary A. Dugan',  'Paul C. Hanson',
    'Julia A. Hart',  'James Kreft',  'Jordan S. Read',  'Luke A. Winslow']
    title: >-
      Water quality data for national-scale aquatic research: The Water Quality Portal, accessed on 2021-04-21
    pubdate: 2017
    link: https://doi.org/10.1002/2016WR019993
  -
    authors: ['Daniel J. Isaak',  'Seth J. Wenger',  'Erin E. Peterson',  'Jay M. Ver Hoef',  'David E. Nagel',  'Charles H. Luce',
    'Steven W. Hostetler',  'Jason B. Dunham',  'Brett B. Roper',  'Sherry P. Wollrab',  'Gwynne L. Chandler',  'Dona L. Horan',  'Sharon Parkes-Payne']
    title: >-
      The NorWeST Summer Stream Temperature Model and Scenarios for the Western U.S.: A Crowd-Sourced Database and
      New Geospatial Tools Foster a User Community and Predict Broad Climate Warming of Rivers and Streams, accessed on 2020-09-29
    pubdate: 2017
    link: https://doi.org/10.1002/2017WR020969
  -
    authors: ['Andrew R Bock', 'Marilyn Santiago', 'Michael E Wieczorek', 'Sydney S Foks', 'Melissa A Lombard']
    title: >-
      Geospatial Fabric for National Hydrologic Modeling, version 1.1
    pubdate: 2020
    link: https://doi.org/10.5066/P971JAGF

process-date: !expr format(Sys.time(),'%Y%m%d')
file-format: one comma-delimited file (metadata), a zipped csv (temperature data), and a zipped shapefile

entities:
  -
    data-name: daily_stream_temperatures.zip
    data-description: >-
      A zipped csv file containing daily water temperature values for streams across the United States. 
    attributes:
    -
      attr-label: site_id
      attr-def: >-
        Site identifier from the source database. This is not necessarily a unique identifier, 
        but can be crosswalked with the site metadata file using a combination of source and site_id.
        From NWIS, this is field "site_no" with a "USGS-" prefix. From WQP, this is field "MonitoringLocationIdentifier".
        From EcoSHEDS, this is a combination of the fields "agency_name"-"location_name".
      attr-defs: This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: date
      attr-def: >-
        Date of observation
      attr-defs: This data release
      data-min: >-
        1894-08-30
      data-max: >-
        2021-04-09
      data-units: NA
    -
      attr-label: mean_temp_degC 
      attr-def: >-
        The average water temperature of all observations taken on the corresponding site-date.
      attr-defs: This data release
      data-min: -0.5
      data-max: 35.0
      data-units: degrees C
    -
      attr-label: min_temp_degC
      attr-def: >-
        The minimum water temperature of all observations taken on the corresponding site-date.
      attr-defs: This data release
      data-min: -0.5
      data-max: 35.0
      data-units: degrees C
    -
      attr-label: max_temp_degC
      attr-def: >-
        The maximum water temperature of all observations taken on the corresponding site-date. Maximum values
        were calculated when two or more observations were collected on the same site-date. 
      attr-defs: This data release
      data-min: -0.5
      data-max: 35.0
      data-units: degrees C
    -
      attr-label: n_obs
      attr-def: >-
        The number of observations made on the corresponding site-date. 
        Note that all data from source "nwis_dv" have NA values because summarized data are provided without 
        the corresponding number of sub-daily observations. In some cases, the n_obs value was
        generated during compilation of these data (e.g., from WQP or nwis_uv when more than one observation
        per site-day was provided). In many cases (EcoSHEDS, NorWeST), this number was provided from the source
        database.
      attr-defs: This data release
      data-min: 1 
      data-max: 124260
      data-units: NA
    -
      attr-label: source
      attr-def: >-
      
        Database from which the temperature observations were retrieved. For more information
        on how observations from each database were gathered and cleaned, see the code
        in "national_stream_temp_code.zip" included in this data release.
        
        
        nwis_dv - U.S. Geological Survey daily data for the nation
        
        nwis_uv - U.S. Geological Survey current conditions for the nation
        
        ecosheds - SHEDS temperature database
        
        norwest - NorWeST database
      attr-defs: This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: flag
      attr-def: >- 
        Indicators that the quality of the data may be affected. All flags except the
        EcoSHEDS comments are from the USGS (nwis_dv or nwis_uv). Users should use
        flagged observations with caution. NA values indicate there were no quality flags from the
        source databases. Provisional flags from the USGS data indicate the observations
        did not receive final review and approval, and are subject to change, but aren't
        directly an indication of poor data quality. Comments from the EcoSHEDS database
        are included because they often indicate something about quality, but need further
        interpretation when using the data. 
        
        Dry = Dry condition exists at the measurement site
        
        Eqp = Value affected by equipment malfunction

        Ice = Value is affected by ice at the measurement site
        
        Mnt = Site under going maintenance
        
        P = Provisional data subject to revision
        
        EC: [comment] = comment from EcoSHEDS that often indicates something about the quality of the data.
      attr-defs: >-
      
        https://help.waterdata.usgs.gov/codes-and-parameters/daily-value-qualification-code-dv_rmk_cd; 
        
        
        https://help.waterdata.usgs.gov/codes-and-parameters/instantaneous-and-daily-value-status-codes; 

      data-min: NA
      data-max: NA
      data-units: NA
  -
    data-name: site_metadata.csv
    data-description: A csv containing metadata for each temperature monitoring site included in daily_stream_temperatures.csv
    attributes:
    -
      attr-label: site_id
      attr-def: >-
        Site identifier from the source database. This is not necessarily a unique identifier, 
        but can be crosswalked with the site metadata file with a combination of source and site_id.
      attr-defs: >-
        This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: site_type
      attr-def: >-
        The type of waterbody on which the temperature observation was made.
        
        
        ST = streams
        
        ST-TS = tidally-influenced streams (ST-TS)
        
        ST-DCH = ditches
        
        SP = springs 
        
        ST-CA = canals 
        
      attr-defs: >-
        https://help.waterdata.usgs.gov/code/site_tp_query?fmt=html
      data-min: NA
      data-max: NA
      data-units: NA  
    -
      attr-label: source
      attr-def: >-
        Database from which the temperature observations were retrieved.
        
        
        nwis_dv - U.S. Geological Survey daily data for the nation
        
        nwis_uv - U.S. Geological Survey current conditions for the nation
        
        ecosheds - SHEDS temperature database
        
        norwest - NorWeST database
      attr-defs: This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: collection_agency
      attr-def: >-
        The organization that collected the temperature records. Collection agencies are coded as the USGS if 
        the data are from source nwis_dv or nwis_uv. From EcoSheds, collection agency come from the "Agency" field.
        From NorWeST, collection agency come from the "Source" field. From WQP, collection agency comes from the "OrganizationIdentifier" field.
      attr-defs: This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: latitude
      attr-def: >-
        Latitude of monitoring location, in decimal degrees (WGS 84) 
      attr-defs: This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: longitude
      attr-def: >-
        Longitude of monitoring location, in decimal degrees (WGS 84)
      attr-defs: This data release
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: seg_id_orig_match
      attr-def: >-
        The closest river reach from the Geospatial Fabric v1.1, by Euclidean distance, from the monitoring site. 
        Matches were limited to a 500m buffer of the monitoring site. The reach number is from the field "nsegment_v1_1" in the 
        Geospatial Fabric for the National Hydrologic Model v1.1.
      attr-defs: https://doi.org/10.5066/P971JAGF
      data-min: NA
      data-max: NA
      data-units: NA
    -
      attr-label: seg_id_reassign
      attr-def: >-
        Once the original reach match was assigned, the matched segment was reassigned if the endpoint of the 
        upstream reach was closer to the monitoring site (by river distance) than the endpoint of the matched reach. 
        If the upstream endpoint was closer, but there was a confluence directly upstream, then the original match was kept.
      attr-defs: https://doi.org/10.5066/P971JAGF
      data-min: NA
      data-max: NA
      data-units: NA
  -
    data-name: national_stream_temp_code.zip
    data-description: >-
      A zipped R Project containing all code used to retrieve and process stream temperature data.
      Code is executed through functions via the .yml files. The 1_ files coordinate the WQP data pull and processing, 
      the 2_ files coordinate the NWIS data pull and processing, the 4_files coordinate the NorWeST and EcoSHEDS 
      download or import and processing. The 5_ files bring all data together, reduces
      duplicates, and flags outliers. The 6_ files match the temperature monitoring locations
      to the Geospatial Fabric for the National Hydrologic Model. 

purpose: water quality research, modeling, climate change
start-date: 18940830
end-date: 20210409

update: none planned
themekeywords: ["water","temperature", "streams","rivers"]

usage-rules: >-
  These data are open access usable via creative commons as long as
  original data providers are acknowledged (see field "collection_agency" in file
  site_metadata.csv for original data providers).

descgeog: "Point location of water temperature monitoring locations"
data-publisher: U.S. Geological Survey
indirect-spatial: U.S.A.
latitude-res: 0.00001
longitude-res: 0.00001

# ----contacts----
contact-person: Samantha K. Oliver
contact-phone: 608-828-9901
contact-email: soliver@usgs.gov
contact-position: Hydrologist
contact-address: "1 Gifford Pinchot Dr"
contact-city: Madison
contact-state: WI
contact-zip: 53726

metadata-person: Samantha K. Oliver
metadata-position: Hydrologist
metadata-phone: 608-828-9901
metadata-fax: 608-821-3817
metadata-email: soliver@usgs.gov
metadata-address: "1 Gifford Pinchot Dr"
metadata-city: Madison
metadata-state: WI
metadata-zip: 53726
metadata-date: !expr format(Sys.time(),'%Y%m%d')

accur-test: No formal attribute accuracy tests were conducted.
funding-credits: >-
  This study was funded by the Integrated Water Prediction Program of the Water Availability and Use Science portfolio.

process-description: >-
  Data were gathered and processed from four sources using the R programming language. Data from the National Water Information System
  (NWIS) and the Water Quality Portal (WQP) were accessed using the R package dataRetrieval. Daily, publicly available data from EcoSHEDS 
  were emailed from database developers. Daily data from NorWeST were accessed by subregion from the database website. 
  
  The following processing steps were made to bring the multi-agency data together into a single file. We retained data
  from sites that were described as streams, springs, ditches, tidally-influenced streams, or canals. However, we did not
  reference the site latitude and longitude to known waterbodies to verify the location was associated with a stream;
  that is, it's possible that observations in this dataset come from a lake, wetland, or reservoir. We excluded
  any observations that did not have enough supporting metadata (site location, date, etc.). We also excluded records that reported
  unrealistic summaries, including daily means that were less than the daily minimum or greater than the daily maximum. 

  
  When bringing the multi-agency data together, we ensured all units were converted to degrees Celsius. In the EcoSHEDS data,
  some data were reported in Celsius that appeared to be more consistent with Fahrenheit (e.g., values above 45). For these records,
  we identified the unique idenifiers that had observations above 45, and assigned those records as having the unit Fahrenheit, and then converted 
  to Celsius. In the NorWest dataset,
  approximately 2.4 million records did not have reported units. We used the following rules (in order) to assign units to the records
  with no reported units; for each site-year, 
  we assigned degrees Celsius as the unit to site-years with a maximum of daily means (maxDM) less than 35 and a minimum of daily means (minDM) less
  than 32. Site-years with maxDM greater than or equal to 35 and a minDM greater than or equal to 32 were assigned as degrees Fahrenheit.
  For remaining records, site-years with maxDM less than 32 or minDM less than 30 were assigned as degrees Celsius. For those records where
  we assigned units to records, we added the flag "EU" for "estimated units". See the script
  munge_data_files.R for more information about how these records were processed. 
  
  In general, we attempted to reduce the dataset down to a single value per site-day. If more
  than one observation per site-day was reported from a single source database, daily summaries were either calculated (in the case of data from WQP or NWISuv)
  or provided directly from the source dataset (in the case of NWISdv, EcoSHEDS, NorWEST, and some data from WQP). 
  If there was only a single observation per site-day, values are reported in the "discrete_temp_degC" column with a
  corresponding local time of collection. However, because NWISdv, NorWest, and EcoSHEDS
  report daily summaries themselves, and in some instances (NWISdv) do not report the number of sub-daily observations,
  there is no guarentee for how well daily summaries represent the true minimum, maximum, and daily mean values.
  Users can use the the number of observations field ("n_obs") to gauge how well the summary value represents the true value, but
  this information is incomplete (NA for all data coming from NWISdv).
  
  In some instances, multiple databases reported the same observations, creating duplicate records in our assembled dataset.
  After assembling all data, we rounded the coordinates (reported in decimal degrees) to four decimal points and
  removed duplicate records with the same rounded coordinates, site identifier, date, and water temperature observation. We expect
  that duplicates records still exist in this dataset given slight differences in reporting (e.g., rounding differences or 
  site identifier differences). We also expect that multiple observations per site-date may exist if multiple agencies collected
  temperature observations at the same site and the same day. We did not further reduce data down to a single value per site-date
  because it was difficult to distinguish between true sub-daily observations and records that were duplicated (but not exact) across
  datasets.
  
  Flags from source databases were retained, and observations from EcoSHEDS 
  with comments that explicitly indicated poor data quality (e.g., "sensor out of water") were removed. All remaining comments
  from EcoSHEDS were included in the flag column and given the prefix "E" given the flag 'ef' because we had no way of defining the flags from EcoSHEDS. 
  We additionally flagged temperature observations 
  we deemed to be outliers. Outliers were determined by finding the mean and standard deviation of all temperature observations in 1 by 1 degree
  areas and 6-day windows; observations that fell outside of three standard deviations of the mean were flagged as outliers but retained 
  in the dataset. 
  
  
  Temperature sites were matched to the Geospatial Fabric for the National Hydrologic Model v1.1 by searching for a matching stream segment
  within a 500 meter buffer. Sites were matched to the closest segment by Euclidean distance, but were then reassigned to an upstream segment
  if the site was closer to the upstream segment's outlet compared to the matched segment's outlet. 
  
  
  More details regarding retrieving and processing this data can be found in the source code provided
  in a zipped repository in this data release (national_stream_temp_code.zip).
  
  

distro-person: Samantha K. Oliver
liability-statement: >-
  Unless otherwise stated, all data, metadata and related materials are considered to satisfy the quality standards relative to the purpose for which the data were collected.
  Although these data and associated metadata have been reviewed for accuracy and completeness and approved for release by the U.S. Geological Survey (USGS),
  no warranty expressed or implied is made regarding the display or utility of the data on any other system or for general or scientific purposes, nor shall
  the act of distribution constitute any such warranty.
